!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("vega-util"),require("vega-dataflow"),require("vega-expression"),require("d3-color"),require("d3-array"),require("d3-format"),require("d3-time-format"),require("vega-scale"),require("vega-scenegraph"),require("vega-event-selector")):"function"==typeof define&&define.amd?define(["exports","vega-util","vega-dataflow","vega-expression","d3-color","d3-array","d3-format","d3-time-format","vega-scale","vega-scenegraph","vega-event-selector"],t):t(e.vega=e.vega||{},e.vega,e.vega,e.vega,e.d3,e.d3,e.d3,e.d3,e.vega,e.vega,e.vega)}(this,function(e,t,n,r,i,a,o,l,u,s,d){"use strict";function f(e,n){t.error(e+' for "outer" push: '+t.stringValue(n))}function c(e,t,n){var r=e+":"+n,i=gt[r];return i&&i[0]===t||(gt[r]=i=[t,t(n)]),i[1]}function p(e,t){return c("timeFormat",l.timeFormat,t)(e)}function g(e,t,n){return ht.setMonth(e),ht.setDate(t),p(ht,n)}function h(e,t,n){try{e[t].apply(e,["EXPRESSION"].concat([].slice.call(n)))}catch(t){e.warn(t)}return n[n.length-1]}function m(e,n){var r;return t.isFunction(e)?e:t.isString(e)?(r=n.scales[e])&&r.value:void 0}function v(e,t,n){var r=xt+n;if(!t.hasOwnProperty(r))try{t[r]=e.scaleRef(n)}catch(e){}}function y(e,t,n,r){if(t[0].type===vt)v(n,r,t[0].value);else if(t[0].type===yt)for(e in n.scales)v(n,r,e)}function b(e){return function(t){return e*Math.exp(t)}}function x(e){return function(t){return Math.log(e*t)}}function k(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function S(e,n,r,i){var a=r(e[0]),o=r(t.peek(e)),l=(o-a)*n;return[i(a-l),i(o-l)]}function R(e,n,r,i,a){var o=i(n),l=i(e[0]),u=i(t.peek(e));return[a(o+(l-o)*r),a(o+(u-o)*r)]}function w(e){return function(t,n,r){var i=m(t,(r||this).context);return i&&i.path[e](n)}}function z(e){var t=this.context.data[e];return t?t.values.value:[]}function P(e,n,r,i){n[0].type!==vt&&t.error("First argument to data functions must be a string literal.");var a=n[0].value,o=kt+a;i.hasOwnProperty(o)||(i[o]=r.getData(a).tuplesRef())}function O(e){return e.data}function D(e,t){var n=z.call(t,e);return n.root&&n.root.lookup||zt}function $(e,n){return e===n||e!==e&&n!==n||!(!t.isArray(e)||!t.isArray(n)||e.length!==n.length)&&j(e,n)}function j(e,t){for(var n=0,r=e.length;n<r;++n)if(!$(e[n],t[n]))return!1;return!0}function E(e){return function(t){for(var n in e)if(!$(t[n],e[n]))return!1;return!0}}function _(e,n){for(var r,i=n.fields,a=n.values,o=n.getter||(n.getter=[]),l=i.length,u=0;u<l;++u)if(o[u]=o[u]||t.field(i[u]),r=o[u](e),t.isDate(r)&&(r=t.toNumber(r)),t.isDate(a[u])&&(a[u]=t.toNumber(a[u])),n[Ot+i[u]]){if(t.isDate(a[u][0])&&(a[u]=a[u].map(t.toNumber)),!Pt(r,a[u],!0,!1))return!1}else if(r!==a[u])return!1;return!0}function V(e,n){for(var r,i,a,o=n.intervals,l=o.length,u=0;u<l;++u){if(i=o[u].extent,r=o[u].getter||(o[u].getter=t.field(o[u].field)),a=r(e),!i||i[0]===i[1])return!1;if(t.isDate(a)&&(a=t.toNumber(a)),t.isDate(i[0])&&(i=o[u].extent=i.map(t.toNumber)),t.isNumber(i[0])&&!Pt(a,i))return!1;if(t.isString(i[0])&&i.indexOf(a)<0)return!1}return!0}function F(e,t,n,r,i,a){for(var o,l,u=this.context.data[e],s=u?u.values.value:[],d=n===Dt,f=s.length,c=0;c<f;++c)if(o=s[c],l=r===o.unit,!(i===jt&&l||i===$t&&!l)&&(l=a(t,o),d^l))return l;return f&&d}function M(e,t){for(var n,r,i,a,o={},l=0,u={},s=[],d=0,f=e.length;d<f;++d)r=(n=e[d]).unit,a=n.value,o[r]||(o[r]=++l),(i=u[a])||(u[a]=i={value:a,units:{},count:0}),i.units[r]||(i.units[r]=++i.count);for(a in u)i=u[a],t===Dt&&i.count!==l||s.push(i.value);return s.length?s:void 0}function A(e,n){for(var r,i,a,o,l=n===Dt?W:C,u=0,s=e.length;u<s;++u)r=e[u].value,t.isDate(r[0])&&(r=r.map(t.toNumber)),(a=r[0])>(o=r[1])&&(o=r[0],a=r[1]),i=i?l(i,a,o):[a,o];return i&&i.length&&+i[0]!=+i[1]?i:void 0}function C(e,t,n){return e[0]>t&&(e[0]=t),e[1]<n&&(e[1]=n),e}function W(e,t,n){return n<e[0]||e[1]<t?[]:(e[0]<t&&(e[0]=t),e[1]>n&&(e[1]=n),e)}function L(e,t,n){return 1===arguments.length?Et[e]:(Et[e]=t,n&&(Mt[e]=n),Ct&&(Ct.functions[e]=Ft+e),this)}function q(e){return e===qt?Lt:e||Lt}function B(e,n){return(e.merge?N:e.stream?T:e.type?U:t.error("Invalid stream specification: "+t.stringValue(e)))(e,n)}function N(e,t){var n=I({merge:e.merge.map(function(e){return B(e,t)})},e,t);return t.addStream(n).id}function T(e,t){var n=I({stream:B(e.stream,t)},e,t);return t.addStream(n).id}function U(e,t){var n=t.event(q(e.source),e.type),r=I({stream:n},e,t);return 1===Object.keys(r).length?n:t.addStream(r).id}function I(e,n,r){var i=n.between;return i&&(2!==i.length&&t.error('Stream "between" parameter must have 2 entries: '+t.stringValue(n)),e.between=[B(i[0],r),B(i[1],r)]),i=n.filter?t.array(n.filter):[],(n.marktype||n.markname||n.markrole)&&i.push(X(n.marktype,n.markname,n.markrole)),n.source===qt&&i.push("inScope(event.item)"),i.length&&(e.filter=Wt("("+i.join(")&&(")+")").$expr),null!=(i=n.throttle)&&(e.throttle=+i),null!=(i=n.debounce)&&(e.debounce=+i),n.consume&&(e.consume=!0),e}function X(e,t,n){var r="event.item";return r+(e&&"*"!==e?"&&"+r+".mark.marktype==='"+e+"'":"")+(n?"&&"+r+".mark.role==='"+n+"'":"")+(t?"&&"+r+".mark.name==='"+t+"'":"")}function H(e,t,n,r){this.id=-1,this.type=e,this.value=t,this.params=n,r&&(this.parent=r)}function Y(e,t,n,r){return new H(e,t,n,r)}function G(e,t){return Y("Operator",e,t)}function J(e){var t={$ref:e.id};return e.id<0&&(e.refs=e.refs||[]).push(t),t}function K(e,t){return t?{$field:e,$name:t}:{$field:e}}function Q(e,t){return{$compare:e,$order:t}}function Z(e){return{$key:e}}function ee(e){return t.isObject(e)?(e.order===Ht?"-":"+")+te(e.op,e.field):""}function te(e,t){return(e&&e.signal?"$"+e.signal:e||"")+(e&&t?"_":"")+(t&&t.signal?"$"+t.signal:t||"")}function ne(e){return e&&e.signal}function re(e,t){return null!=e?e:t}function ie(e){return function(t,n,r){return Y(e,n,t||void 0,r)}}function ae(e){return wn.hasOwnProperty(e)}function oe(e){return"quantile"===e}function le(e,n){var r=e.type||"linear";Rn.hasOwnProperty(r)||t.error("Unrecognized scale type: "+t.stringValue(r)),n.addScale(e.name,{type:r,domain:void 0})}function ue(e,t){var n,r=t.getScale(e.name).params;r.domain=ce(e.domain,e,t),null!=e.range&&(r.range=Se(e,t,r)),null!=e.interpolate&&ke(e.interpolate,r);for(n in e)r.hasOwnProperty(n)||"name"===n||(r[n]=se(e[n],t))}function se(e,n){return t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported object: "+t.stringValue(e)):e}function de(e,t){return e.signal?t.signalRef(e.signal):e.map(function(e){return se(e,t)})}function fe(e){t.error("Can not find data set: "+t.stringValue(e))}function ce(e,n,r){if(e)return e.signal?r.signalRef(e.signal):(t.isArray(e)?pe:e.fields?he:ge)(e,n,r);null==n.domainMin&&null==n.domainMax||t.error("No scale domain defined for domainMin/domainMax to override.")}function pe(e,t,n){return e.map(function(e){return se(e,n)})}function ge(e,t,n){var r=n.getData(e.data);return r||fe(e.data),ae(t.type)?r.valuesRef(n,e.field,ye(e.sort,!1)):oe(t.type)?r.domainRef(n,e.field):r.extentRef(n,e.field)}function he(e,n,r){var i=e.data,a=e.fields.reduce(function(e,n){return n=t.isString(n)?{data:i,field:n}:t.isArray(n)||n.signal?me(n,r):n,e.push(n),e},[]);return(ae(n.type)?ve:oe(n.type)?be:xe)(e,r,a)}function me(e,n){var r="_:vega:_"+kn++,i=Kt({});return t.isArray(e)?i.value={$ingest:e}:e.signal&&n.signalRef("setdata("+t.stringValue(r)+","+e.signal+")"),n.addDataPipeline(r,[i,vn({})]),{data:r,field:"data"}}function ve(e,t,n){var r,i,a,o;return r=n.map(function(e){var n=t.getData(e.data);return n||fe(e.data),n.countsRef(t,e.field)}),i=t.add(Yt({groupby:Xt,ops:["sum"],fields:[t.fieldRef("count")],as:["count"],pulse:r})),a=t.add(Kt({pulse:J(i)})),o=t.add(xn({field:Xt,sort:t.sortRef(ye(e.sort,!0)),pulse:J(a)})),J(o)}function ye(e,n){return e&&(e.field||e.op?e.field||"count"===e.op?n&&e.field?t.error("Multiple domain scales can not sort by field."):n&&e.op&&"count"!==e.op&&t.error("Multiple domain scales support op count only."):t.error("No field provided for sort aggregate op: "+e.op):t.isObject(e)?e.field="key":e={field:"key"}),e}function be(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);return n||fe(e.data),n.domainRef(t,e.field)});return J(t.add(un({values:r})))}function xe(e,t,n){var r=n.map(function(e){var n=t.getData(e.data);return n||fe(e.data),n.extentRef(t,e.field)});return J(t.add(ln({extents:r})))}function ke(e,t){t.interpolate=se(e.type||e),null!=e.gamma&&(t.interpolateGamma=se(e.gamma))}function Se(e,n,r){var i=e.range,a=n.config.range;if(i.signal)return n.signalRef(i.signal);if(t.isString(i)){if(a&&a.hasOwnProperty(i))return e=t.extend({},e,{range:a[i]}),Se(e,n,r);"width"===i?i=[0,{signal:"width"}]:"height"===i?i=ae(e.type)?[0,{signal:"height"}]:[{signal:"height"},0]:t.error("Unrecognized scale range value: "+t.stringValue(i))}else{if(i.scheme)return r.scheme=se(i.scheme,n),i.extent&&(r.schemeExtent=de(i.extent,n)),void(i.count&&(r.schemeCount=se(i.count,n)));if(i.step)return void(r.rangeStep=se(i.step,n));if(ae(e.type)&&!t.isArray(i))return ce(i,e,n);t.isArray(i)||t.error("Unsupported range type: "+t.stringValue(i))}return i.map(function(e){return se(e,n)})}function Re(e,n){return t.isArray(e)?e.map(function(e){return Re(e,n)}):t.isObject(e)?e.signal?n.signalRef(e.signal):t.error("Unsupported parameter object: "+t.stringValue(e)):e}function we(e,n,r,i){var a,o,l;if(e.signal)a="datum",l=An(e.signal,n,r,i);else if(e.group||e.parent){for(o=Math.max(1,e.level||1),a="item";o-- >0;)a+=".mark.group";e.parent?(l=e.parent,a+=".datum"):l=e.group}else e.datum?(a="datum",l=e.datum):t.error("Invalid field reference: "+t.stringValue(e));return e.signal||(t.isString(l)?(i[l]=1,l=t.splitAccessPath(l).map(t.stringValue).join("][")):l=we(l,n,r,i)),a+"["+l+"]"}function ze(e,n){if(!t.isString(e))return-1;var r=n.scaleType(e);return"band"===r||"point"===r?1:0}function Pe(e,n,r,i){var a;if(t.isString(e))a=xt+e,r.hasOwnProperty(a)||(r[a]=n.scaleRef(e)),a=t.stringValue(a);else{for(a in n.scales)r[xt+a]=n.scaleRef(a);a=t.stringValue(xt)+"+"+(e.signal?"("+An(e.signal,n,r,i)+")":Cn(e,n,r,i))}return"_["+a+"]"}function Oe(e,n,r,i){var a,o,l,u={},s="var o=item,datum=o.datum,$;";for(a in e)o=e[a],t.isArray(o)?s+=Tn(a,o,i,r,u):(l=Bn(a,o,i,r,u),s+=Nn("o",a,l));return s+=Fn(e,n),s+="return 1;",{$expr:s,$fields:Object.keys(u),$output:Object.keys(e)}}function De(e){return t.isObject(e)?e:{value:e}}function $e(e,t,n){return null!=n?(e[t]={value:n},1):0}function je(e,n,r){for(var i in n)r&&r.hasOwnProperty(i)||(e[i]=t.extend(e[i]||{},n[i]));return e}function Ee(e,t,n,r,i){var a,o;(i=i||{}).encoders={$encode:a={}},e=_e(e,t,n,r.config);for(o in e)a[o]=Oe(e[o],t,i,r);return i}function _e(e,n,r,i){var a,o;"legend"!=r&&0!==String(r).indexOf("axis")||(r=null),i=r===In?i.group:r===Un||i[n=r]?t.extend({},i.mark,i[n]):{},a={};for(o in i)Ve(o,e)||("fill"===o||"stroke"===o)&&(Ve("fill",e)||Ve("stroke",e))||(a[o]={value:i[o]});return e=t.extend({},e),e.enter=t.extend(a,e.enter),e}function Ve(e,t){return t&&(t.enter&&t.enter[e]||t.update&&t.update[e])}function Fe(e,t,n){var r,i,a,o={};for(i=0,a=e.params.length;i<a;++i)o[(r=e.params[i]).name]=Me(r,t,n);return o}function Me(e,n,r){var i=e.type,a=n[e.name];if("index"===i)return Ce(e,n,r);{if(void 0!==a)return"param"===i?We(e,n,r):"projection"===i?r.projectionRef(n[e.name]):e.array&&!ne(a)?a.map(function(t){return Ae(e,t,r)}):Ae(e,a,r);e.required&&t.error("Missing required "+t.stringValue(n.type)+" parameter: "+t.stringValue(e.name))}}function Ae(e,n,r){var i=e.type;if(ne(n))return Te(i)?t.error("Expression references can not be signals."):Ue(i)?r.fieldRef(n):Ie(i)?r.compareRef(n):r.signalRef(n.signal);var a=e.expr||Ue(i);return a&&qe(n)?Wt(n.expr,r):a&&Be(n)?K(n.field):Te(i)?Wt(n,r):Ne(i)?J(r.getData(n).values):Ue(i)?K(n):Ie(i)?r.compareRef(n):n}function Ce(e,n,r){return t.isString(n.from)||t.error('Lookup "from" parameter must be a string literal.'),r.getData(n.from).lookupRef(r,n.key)}function We(e,n,r){var i=n[e.name];return e.array?(t.isArray(i)||t.error("Expected an array of sub-parameters. Instead: "+t.stringValue(i)),i.map(function(t){return Le(e,t,r)})):Le(e,i,r)}function Le(e,n,r){var i,a,o,l,u;for(l=0,u=e.params.length;l<u;++l){a=e.params[l];for(o in a.key)if(a.key[o]!==n[o]){a=null;break}if(a)break}return a||t.error("Unsupported parameter: "+t.stringValue(n)),i=t.extend(Fe(a,n,r),a.key),J(r.add(dn(i)))}function qe(e){return e&&e.expr}function Be(e){return e&&e.field}function Ne(e){return"data"===e}function Te(e){return"expr"===e}function Ue(e){return"field"===e}function Ie(e){return"compare"===e}function Xe(e,t,n,r,i){this.scope=e,this.input=t,this.output=n,this.values=r,this.aggregate=i,this.index={}}function He(e){return t.isString(e)?e:null}function Ye(e,t,n){var r,i=te(n.op,n.field);if(t.ops){for(var a=0,o=t.as.length;a<o;++a)if(t.as[a]===i)return}else t.ops=["count"],t.fields=[null],t.as=["count"];n.op&&(t.ops.push((r=n.op.signal)?e.signalRef(r):n.op),t.fields.push(e.fieldRef(n.field)),t.as.push(i))}function Ge(e,t,n,r,i,a,o){var l,u,s=t[n]||(t[n]={}),d=ee(a),f=He(i);if(null!=f&&(e=t.scope,l=s[f+=d?"|"+d:""]),!l){var c=a?{field:Xt,pulse:t.countsRef(e,i,a)}:{field:e.fieldRef(i),pulse:J(t.output)};d&&(c.sort=e.sortRef(a)),u=e.add(Y(r,void 0,c)),o&&(t.index[i]=u),l=J(u),null!=f&&(s[f]=l)}return l}function Je(e,t,n){var r,i=+t.symbolSize;return(r=n&&n.update&&n.update.fontSize)||(r=n&&n.enter&&n.enter.fontSize),r&&(r=r.value),r||(r=+t.labelFontSize),e.size?{$expr:"Math.max(Math.ceil(Math.sqrt(_.scale(datum))),"+r+")"}:Math.max(Math.ceil(Math.sqrt(i)),r)}function Ke(e){var t={};return $e(t,"fill",e.fillColor)+$e(t,"stroke",e.strokeColor)+$e(t,"strokeWidth",e.strokeWidth)+$e(t,"strokeDash",e.strokeDash)+$e(t,"cornerRadius",e.cornerRadius)?t:void 0}function Qe(e,n,r,i){var a,o,l,u,s,d,f=e.text,c=e.orient||n.orient,p=e.anchor||n.anchor,g=c===On||c===Pn?-1:1,h=c===Pn||c===Dn,m={group:h?"width":"height"},v={};return v.enter=a={opacity:{value:0}},$e(a,"fill",n.color),$e(a,"font",n.font),$e(a,"fontSize",n.fontSize),$e(a,"fontWeight",n.fontWeight),v.exit={opacity:{value:0}},v.update=o={opacity:{value:1},text:t.isObject(f)?f:{value:f+""},offset:De((null!=e.offset?e.offset:n.offset)||0)},"start"===p?(s=0,d="left"):"end"===p?(s=1,d="right"):(s=.5,d="center"),l={field:m,mult:s},u=g<0?{value:0}:h?{field:{group:"height"}}:{field:{group:"width"}},h?(o.x=l,o.y=u,o.angle={value:0},o.baseline={value:c===Pn?"bottom":"top"}):(o.x=u,o.y=l,o.angle={value:90*g},o.baseline={value:"bottom"}),o.align={value:d},o.limit={field:m},$e(o,"angle",n.angle),$e(o,"baseline",n.baseline),$e(o,"limit",n.limit),Hn(Gn,Xn,null,i,v,r)}function Ze(e,t){var n=[];e.transform&&e.transform.forEach(function(e){n.push(ar(e,t))}),e.on&&e.on.forEach(function(n){dr(n,t,e.name)}),t.addDataPipeline(e.name,et(e,t,n))}function et(e,t,n){var r,i,a,o,l,u=[],s=null,d=!1,f=!1;for(e.values?u.push(s=tt({$ingest:e.values,$format:e.format})):e.url?u.push(s=tt({$request:e.url,$format:e.format})):e.source&&(s=(r=t.getData(e.source)).output,u.push(null)),i=0,a=n.length;i<a;++i)l=(o=n[i]).metadata,s||l.source||u.push(s=tt()),u.push(o),l.generates&&(f=!0),l.modifies&&!f&&(d=!0),l.source?s=o:l.changes&&(s=null);return r&&(u[0]=gn({derive:d,pulse:J(r.output)}),d&&u.splice(1,0,tt())),s||u.push(tt()),u.push(vn({})),u}function tt(e){var t=Kt({},e);return t.metadata={source:!0},t}function nt(e,t){return{scale:e.scale,range:t}}function rt(e,n){var r,i,a,o,l,u=n.config;return n.background=e.background||u.background,n.eventConfig=u.events,l=J(n.root=n.add(G())),n.addSignal("width",e.width||-1),n.addSignal("height",e.height||-1),n.addSignal("padding",ft(e.padding,u)),n.addSignal("autosize",dt(e.autosize,u)),t.array(e.signals).forEach(function(e){Sr[e.name]||pt(e,n)}),i=n.add(Kt()),a=je({enter:{x:{value:0},y:{value:0}},update:{width:{signal:"width"},height:{signal:"height"}}},e.encode),a=n.add(en(Ee(a,Yn,In,n,{pulse:J(i)}))),o=n.add(bn({layout:n.objectProperty(e.layout),legendMargin:u.legendMargin,autosize:n.signalRef("autosize"),mark:l,pulse:J(a)})),n.operators.pop(),n.pushState(J(a),J(o),null),kr(e,n,!0),n.operators.push(o),r=n.add(Jt({mark:l,pulse:J(o)})),r=n.add(hn({pulse:J(r)})),r=n.add(vn({pulse:J(r)})),n.addData("root",new Xe(n,i,i,r)),n}function it(e){this.config=e,this.bindings=[],this.field={},this.signals={},this.lambdas={},this.scales={},this.events={},this.data={},this.streams=[],this.updates=[],this.operators=[],this.background=null,this.eventConfig=null,this._id=0,this._subid=0,this._nextsub=[0],this._parent=[],this._encode=[],this._lookup=[],this._markpath=[]}function at(e){this.config=e.config,this.field=Object.create(e.field),this.signals=Object.create(e.signals),this.lambdas=Object.create(e.lambdas),this.scales=Object.create(e.scales),this.events=Object.create(e.events),this.data=Object.create(e.data),this.streams=[],this.updates=[],this.operators=[],this._id=0,this._subid=++e._nextsub[0],this._nextsub=e._nextsub,this._parent=e._parent.slice(),this._encode=e._encode.slice(),this._lookup=e._lookup.slice(),this._markpath=e._markpath}function ot(e){return(t.isArray(e)?lt:ut)(e)}function lt(e){for(var n,r="[",i=0,a=e.length;i<a;++i)n=e[i],r+=(i>0?",":"")+(t.isObject(n)?n.signal||ot(n):t.stringValue(n));return r+"]"}function ut(e){var n,r,i="{",a=0;for(n in e)r=e[n],i+=(++a>1?",":"")+t.stringValue(n)+":"+(t.isObject(r)?r.signal||ot(r):t.stringValue(r));return i+"}"}function st(){return{padding:0,autosize:"pad",background:null,events:{defaults:{allow:["wheel"]}},group:null,mark:null,arc:{fill:Or},area:{fill:Or},image:null,line:{stroke:Or,strokeWidth:Pr},path:{stroke:Or},rect:{fill:Or},rule:{stroke:Dr},shape:{stroke:Or},symbol:{fill:Or,size:64},text:{fill:Dr,font:"sans-serif",fontSize:11},point:{size:zr,strokeWidth:Pr,shape:"circle"},circle:{size:zr,strokeWidth:Pr},square:{size:zr,strokeWidth:Pr},axis:{minExtent:0,maxExtent:200,bandPosition:.5,domain:!0,domainWidth:1,domainColor:Dr,grid:!1,gridWidth:1,gridColor:jr,gridDash:[],gridOpacity:1,labels:!0,labelAngle:0,labelColor:Dr,labelFont:"sans-serif",labelFontSize:10,labelLimit:180,labelPadding:2,ticks:!0,tickColor:Dr,tickOffset:0,tickRound:!0,tickSize:5,tickWidth:1,titleAlign:"center",titlePadding:2,titleColor:Dr,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},axisBand:{tickOffset:-1},legend:{orient:"right",offset:18,padding:0,entryPadding:5,titlePadding:5,gradientWidth:100,gradientHeight:20,gradientStrokeColor:jr,gradientStrokeWidth:0,gradientLabelBaseline:"top",gradientLabelOffset:2,labelColor:Dr,labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,labelLimit:160,symbolType:"circle",symbolSize:100,symbolColor:$r,symbolStrokeWidth:1.5,titleColor:Dr,titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleAlign:"left",titleBaseline:"top",titleLimit:180},title:{orient:"top",anchor:"middle",offset:2,color:Dr,font:"sans-serif",fontSize:13,fontWeight:"bold"},range:{category:{scheme:"tableau10"},ordinal:{scheme:"blues",extent:[.2,1]},heatmap:{scheme:"viridis"},ramp:{scheme:"blues",extent:[.2,1]},diverging:{scheme:"blueorange"},symbol:["circle","square","triangle-up","cross","diamond","triangle-right","triangle-down","triangle-left"]}}}var dt=function(e,n){return e=e||n.autosize,t.isObject(e)?e:(e=e||"pad",{type:e})},ft=function(e,n){return e=e||n.padding,t.isObject(e)?e:(e=+e||0,{top:e,bottom:e,left:e,right:e})},ct=["value","update","react","bind"],pt=function(e,t){var n=e.name;if("outer"===e.push)t.signals[n]||f("No prior signal definition",n),ct.forEach(function(t){void 0!==e[t]&&f("Invalid property ",t)});else{var r=t.addSignal(n,e.value);!1===e.react&&(r.react=!1),e.bind&&t.addBinding(n,e.bind)}},gt={},ht=new Date(2e3,0,1),mt="undefined"!=typeof window&&window||null,vt="Literal",yt="Identifier",bt="@",xt="%",kt=":",St=w("area"),Rt=w("bounds"),wt=w("centroid"),zt={},Pt=function(e,t,n,r){var i,a=t[0],o=t[t.length-1];return a>o&&(i=a,a=o,o=i),n=void 0===n||n,r=void 0===r||r,(n?a<=e:a<e)&&(r?e<=o:e<o)},Ot="bin_",Dt="intersect",$t="unit",jt="others",Et={isArray:t.isArray,isBoolean:t.isBoolean,isDate:t.isDate,isNumber:t.isNumber,isObject:t.isObject,isRegExp:t.isRegExp,isString:t.isString,isTuple:n.isTuple,toBoolean:t.toBoolean,toDate:t.toDate,toNumber:t.toNumber,toString:t.toString,pad:t.pad,truncate:t.truncate,rgb:i.rgb,lab:i.lab,hcl:i.hcl,hsl:i.hsl,sequence:a.range,format:function(e,t){return c("format",o.format,t)(e)},utcFormat:function(e,t){return c("utcFormat",l.utcFormat,t)(e)},utcParse:function(e,t){return c("utcParse",l.utcParse,t)(e)},timeFormat:p,timeParse:function(e,t){return c("timeParse",l.timeParse,t)(e)},monthFormat:function(e){return g(e,1,"%B")},monthAbbrevFormat:function(e){return g(e,1,"%b")},dayFormat:function(e){return g(0,2+e,"%A")},dayAbbrevFormat:function(e){return g(0,2+e,"%a")},quarter:function(e){return 1+~~(new Date(e).getMonth()/3)},utcquarter:function(e){return 1+~~(new Date(e).getUTCMonth()/3)},warn:function(){return h(this.context.dataflow,"warn",arguments)},info:function(){return h(this.context.dataflow,"info",arguments)},debug:function(){return h(this.context.dataflow,"debug",arguments)},inScope:function(e){var t=this.context.group,n=!1;if(t)for(;e;){if(e===t){n=!0;break}e=e.mark.group}return n},clampRange:function(e,t,n){var r,i=e[0],a=e[1];return a<i&&(r=a,a=i,i=r),(r=a-i)>=n-t?[t,n]:[Math.min(Math.max(i,t),n-r),Math.min(Math.max(a,r),n)]},pinchDistance:function(e){var t=e.touches,n=t[0].clientX-t[1].clientX,r=t[0].clientY-t[1].clientY;return Math.sqrt(n*n+r*r)},pinchAngle:function(e){var t=e.touches;return Math.atan2(t[0].clientY-t[1].clientY,t[0].clientX-t[1].clientX)},screen:function(){return mt?mt.screen:{}},containerSize:function(){var e=this.context.dataflow,t=e.container&&e.container();return t?[t.clientWidth,t.clientHeight]:[void 0,void 0]},windowSize:function(){return mt?[mt.innerWidth,mt.innerHeight]:[void 0,void 0]},span:function(e){return e[e.length-1]-e[0]||0},bandspace:function(e,t,n){return u.bandSpace(e||0,t||0,n||0)},inrange:Pt,setdata:function(e,n){var r=this.context.dataflow,i=this.context.data[e].input;return r.pulse(i,r.changeset().remove(t.truthy).insert(n)),1},panLinear:function(e,n){return S(e,n,t.toNumber,t.identity)},panLog:function(e,t){var n=Math.sign(e[0]);return S(e,t,x(n),b(n))},panPow:function(e,t,n){return S(e,t,k(n),k(1/n))},zoomLinear:function(e,n,r){return R(e,n,r,t.toNumber,t.identity)},zoomLog:function(e,t,n){var r=Math.sign(e[0]);return R(e,t,n,x(r),b(r))},zoomPow:function(e,t,n,r){return R(e,t,n,k(r),k(1/r))},encode:function(e,t,n){if(e){var r=this.context.dataflow,i=e.mark.source;r.pulse(i,r.changeset().encode(e,t))}return void 0!==n?n:e},modify:function(e,r,i,a,o,l){var u,s,d=this.context.dataflow,f=this.context.data[e],c=f.input,p=f.changes,g=d.stamp();if(!1===d._trigger||!(c.value.length||r||a))return 0;if((!p||p.stamp<g)&&(f.changes=p=d.changeset(),p.stamp=g,d.runAfter(function(){f.modified=!0,d.pulse(c,p).run()},!0)),i&&(u=!0===i?t.truthy:t.isArray(i)||n.isTuple(i)?i:E(i),p.remove(u)),r&&p.insert(r),a&&(u=E(a),c.value.some(u)?p.remove(u):p.insert(a)),o)for(s in l)p.modify(o,s,l[s]);return 1}},_t=["view","item","group","xy","x","y"],Vt="event.vega.",Ft="this.",Mt={};L("bandwidth",function(e,t){var n=m(e,(t||this).context);return n&&n.bandwidth?n.bandwidth():0},y),L("copy",function(e,t){var n=m(e,(t||this).context);return n?n.copy():void 0},y),L("domain",function(e,t){var n=m(e,(t||this).context);return n?n.domain():[]},y),L("range",function(e,t){var n=m(e,(t||this).context);return n&&n.range?n.range():[]},y),L("invert",function(e,n,r){var i=m(e,(r||this).context);return i?t.isArray(n)?(i.invertRange||i.invert)(n):(i.invert||i.invertExtent)(n):void 0},y),L("scale",function(e,t,n){var r=m(e,(n||this).context);return r?r(t):void 0},y),L("gradient",function(e,t,n,r){var i=s.Gradient(t,n),a=e.domain(),o=a[0],l=a[a.length-1],d=u.scaleFraction(e,o,l);e.ticks&&(o!==(a=e.ticks(+r||15))[0]&&a.unshift(o),l!==a[a.length-1]&&a.push(l));for(var f=0,c=a.length;f<c;++f)i.stop(d(a[f]),e(a[f]));return i},y),L("geoArea",St,y),L("geoBounds",Rt,y),L("geoCentroid",wt,y),L("indata",function(e,t,n){var r=this.context.data[e]["index:"+t],i=r?r.value.get(n):void 0;return i?i.count:i},function(e,n,r,i){n[0].type!==vt&&t.error("First argument to indata must be a string literal."),n[1].type!==vt&&t.error("Second argument to indata must be a string literal.");var a=n[0].value,o=n[1].value,l=bt+o;i.hasOwnProperty(l)||(i[l]=r.getData(a).indataRef(r,o))}),L("data",z,P),L("vlPoint",function(e,t,n,r,i){return F.call(this,e,t,n,r,i,_)},P),L("vlInterval",function(e,t,n,r,i){return F.call(this,e,t,n,r,i,V)},P),L("vlPointDomain",function(e,t,n,r){var i,a,o,l,u=this.context.data[e],s=u?u.values.value:[],d=s[0],f=0;if(d){for(i=t?d.encodings.length:d.fields.length;f<i;++f)if(t&&d.encodings[f]===t||n&&d.fields[f]===n){a=f,l=d[Ot+d.fields[f]];break}return o=s.reduce(function(e,t){return e.push({unit:t.unit,value:t.values[a]}),e},[]),l?A(o,r):M(o,r)}},P),L("vlIntervalDomain",function(e,t,n,r){var i,a,o,l,u,s=this.context.data[e],d=s?s.values.value:[],f=d[0],c=0;if(f){for(i=f.intervals.length;c<i;++c)if(a=f.intervals[c],t&&a.encoding===t||n&&a.field===n){if(!a.extent)return;o=c,u=a.extent.length>2;break}return l=d.reduce(function(e,t){var n=t.intervals[o].extent,r=u?n.map(function(e){return{unit:t.unit,value:e}}):{unit:t.unit,value:n};return u?(e.push.apply(e,r),e):(e.push(r),e)},[]),u?M(l,r):A(l,r)}},P),L("treePath",function(e,t,n){var r=D(e,this),i=r[t],a=r[n];return i&&a?i.path(a).map(O):void 0},P),L("treeAncestors",function(e,t){var n=D(e,this)[t];return n?n.ancestors().map(O):void 0},P);var At={blacklist:["_"],whitelist:["datum","event","item"],fieldvar:"datum",globalvar:function(e){return"_["+t.stringValue("$"+e)+"]"},functions:function(e){var t=r.functions(e);_t.forEach(function(e){t[e]=Vt+e});for(var n in Et)t[n]=Ft+n;return t},constants:r.constants,visitors:Mt},Ct=r.codegen(At),Wt=function(e,n,i){var a,o,l={};try{a=r.parse(e)}catch(n){t.error("Expression parse error: "+t.stringValue(e))}return a.visit(function(e){if("CallExpression"===e.type){var t=e.callee.name,r=At.visitors[t];r&&r(t,e.arguments,n,l)}}),(o=Ct(a)).globals.forEach(function(e){var t="$"+e;!l.hasOwnProperty(t)&&n.getSignal(e)&&(l[t]=n.signalRef(e))}),{$expr:i?i+"return("+o.code+");":o.code,$fields:o.fields,$params:l}},Lt="view",qt="scope",Bt=function(e,t){return e.signal?t.getSignal(e.signal).id:e.scale?t.getScale(e.scale).id:B(e,t)},Nt="var datum=event.item&&event.item.datum;",Tt=function(e,n,r){var i,a=e.events,o=e.update,l=e.encode,u=[],s="";a||t.error("Signal update missing events specification."),t.isString(a)&&(a=d.selector(a)),(a=t.array(a).filter(function(e){return e.signal||e.scale?(u.push(e),0):1})).length&&u.push(a.length>1?{merge:a}:a[0]),null!=l&&(o&&t.error("Signal encode and update are mutually exclusive."),o="encode(item(),"+t.stringValue(l)+")"),s=t.isString(o)?Wt(o,n,Nt):null!=o.expr?Wt(o.expr,n,Nt):null!=o.value?o.value:null!=o.signal?{$expr:"_.value",$params:{value:n.signalRef(o.signal)}}:t.error("Invalid signal update specification."),i={target:r,update:s},e.force&&(i.options={force:!0}),u.forEach(function(e){e={source:Bt(e,n)},n.addUpdate(t.extend(e,i))})},Ut=function(e,t){var n=t.getSignal(e.name);if(e.update){var r=Wt(e.update,t);n.update=r.$expr,n.params=r.$params}e.on&&e.on.forEach(function(e){Tt(e,t,n.id)})},It={$tupleid:1,toString:function(){return":_tupleid_:"}},Xt=K("key"),Ht="descending",Yt=ie("Aggregate"),Gt=ie("AxisTicks"),Jt=ie("Bound"),Kt=ie("Collect"),Qt=ie("Compare"),Zt=ie("DataJoin"),en=ie("Encode"),tn=ie("Facet"),nn=ie("Field"),rn=ie("Key"),an=ie("LegendEntries"),on=ie("Mark"),ln=ie("MultiExtent"),un=ie("MultiValues"),sn=ie("Overlap"),dn=ie("Params"),fn=ie("PreFacet"),cn=ie("Projection"),pn=ie("Proxy"),gn=ie("Relay"),hn=ie("Render"),mn=ie("Scale"),vn=ie("Sieve"),yn=ie("SortItems"),bn=ie("ViewLayout"),xn=ie("Values"),kn=0,Sn=["identity","ordinal","band","point","bin-linear","bin-ordinal","linear","pow","sqrt","log","sequential","time","utc","quantize","quantile","threshold"],Rn=t.toSet(Sn),wn=t.toSet(Sn.slice(1,6)),zn=function(e,t){var n={};for(var r in e)"name"!==r&&(n[r]=Re(e[r],t));t.addProjection(e.name,n)},Pn="top",On="left",Dn="bottom",$n="value",jn=["shape","size","fill","stroke","strokeDash","opacity"],En={name:1,interactive:1},_n=t.toSet(["rule"]),Vn=t.toSet(["group","image","rect"]),Fn=function(e,t){var n="";return _n[t]?n:(e.x2&&(e.x?(Vn[t]&&(n+="if(o.x>o.x2)$=o.x,o.x=o.x2,o.x2=$;"),n+="o.width=o.x2-o.x;"):n+="o.x=o.x2-(o.width||0);"),e.xc&&(n+="o.x=o.xc-(o.width||0)/2;"),e.y2&&(e.y?(Vn[t]&&(n+="if(o.y>o.y2)$=o.y,o.y=o.y2,o.y2=$;"),n+="o.height=o.y2-o.y;"):n+="o.y=o.y2-(o.height||0);"),e.yc&&(n+="o.y=o.yc-(o.height||0)/2;"),n)},Mn=function(e,t,n,r){function i(e,i,a,o){return"this."+e+"("+[Bn(null,i,t,n,r),Bn(null,a,t,n,r),Bn(null,o,t,n,r)].join(",")+").toString()"}return e.c?i("hcl",e.h,e.c,e.l):e.h||e.s?i("hsl",e.h,e.s,e.l):e.l||e.a?i("lab",e.l,e.a,e.b):e.r||e.g||e.b?i("rgb",e.r,e.g,e.b):null},An=function(e,n,r,i){var a=Wt(e,n);return a.$fields.forEach(function(e){i[e]=1}),t.extend(r,a.$params),a.$expr},Cn=function(e,n,r,i){return we(t.isObject(e)?e:{datum:e},n,r,i)},Wn=function(e,t,n,r,i){var a,o,l,u=Pe(e.scale,n,r,i);return null!=e.range?(o=u+".range()",t=0===(a=+e.range)?o+"[0]":"($="+o+","+(1===a?"$[$.length-1]":"$[0]+"+a+"*($[$.length-1]-$[0])")+")"):(void 0!==t&&(t=u+"("+t+")"),e.band&&(l=ze(e.scale,n))&&(a=(o=u+".bandwidth")+"()"+(1===(a=+e.band)?"":"*"+a),l<0&&(a="("+o+"?"+a+":0)"),t=(t?t+"+":"")+a,e.extra&&(t="(datum.extra?"+u+"(datum.extra.value):"+t+")")),null==t&&(t="0")),t},Ln=function(e,n,r,i){return"this.gradient("+Pe(e.gradient,n,r,i)+","+t.stringValue(e.start)+","+t.stringValue(e.stop)+","+t.stringValue(e.count)+")"},qn=function(e,n,r,i){return t.isObject(e)?"("+Bn(null,e,n,r,i)+")":e},Bn=function(e,n,r,i,a){if(null!=n.gradient)return Ln(n,r,i,a);var o=n.signal?An(n.signal,r,i,a):n.color?Mn(n.color,r,i,a):null!=n.field?Cn(n.field,r,i,a):void 0!==n.value?t.stringValue(n.value):void 0;return null!=n.scale&&(o=Wn(n,o,r,i,a)),void 0===o&&(o=null),null!=n.exponent&&(o="Math.pow("+o+","+qn(n.exponent,r,i,a)+")"),null!=n.mult&&(o+="*"+qn(n.mult,r,i,a)),null!=n.offset&&(o+="+"+qn(n.offset,r,i,a)),n.round&&(o="Math.round("+o+")"),o},Nn=function(e,n,r){return e+"["+t.stringValue(n)+"]="+r+";"},Tn=function(e,t,n,r,i){var a="";return t.forEach(function(t){var o=Bn(e,t,n,r,i);a+=t.test?An(t.test,n,r,i)+"?"+o+":":o}),Nn("o",e,a)},Un="mark",In="frame",Xn="title",Hn=function(e,t,n,r,i,a){return{type:e,name:a?a.name:void 0,role:t,key:n,from:r,interactive:!(!a||!a.interactive),encode:je(i,a,En)}},Yn="group",Gn="text",Jn=function(e,t,n){var r,i,a={value:0},o={};return o.enter=r={opacity:a,x:a,y:a},$e(r,"width",t.gradientWidth),$e(r,"height",t.gradientHeight),$e(r,"stroke",t.gradientStrokeColor),$e(r,"strokeWidth",t.gradientStrokeWidth),o.exit={opacity:a},o.update=i={x:a,y:a,fill:{gradient:e},opacity:{value:1}},$e(i,"width",t.gradientWidth),$e(i,"height",t.gradientHeight),Hn("rect","legend-gradient",void 0,void 0,o,n)},Kn=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o,text:{field:"label"}},$e(i,"fill",t.labelColor),$e(i,"font",t.labelFont),$e(i,"fontSize",t.labelFontSize),$e(i,"baseline",t.gradientLabelBaseline),$e(i,"limit",t.gradientLabelLimit),l.exit={opacity:o},l.update=a={opacity:{value:1}},i.x=a.x={field:"perc",mult:t.gradientWidth},i.y=a.y={value:t.gradientHeight,offset:t.gradientLabelOffset},i.align=a.align={signal:'datum.perc<=0?"left":datum.perc>=1?"right":"center"'},Hn(Gn,"legend-label","perc",r,l,n)},Qn=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o},$e(i,"align",t.labelAlign),$e(i,"baseline",t.labelBaseline),$e(i,"fill",t.labelColor),$e(i,"font",t.labelFont),$e(i,"fontSize",t.labelFontSize),$e(i,"limit",t.labelLimit),l.exit={opacity:o},l.update=a={opacity:{value:1},text:{field:"label"}},i.x=a.x={field:"offset",offset:t.labelOffset},i.y=a.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},Hn(Gn,"legend-label",$n,r,l,n)},Zn=function(e,t,n,r){var i,a,o={value:0},l={};return l.enter=i={opacity:o},$e(i,"shape",t.symbolType),$e(i,"size",t.symbolSize),$e(i,"strokeWidth",t.symbolStrokeWidth),e.fill||$e(i,"stroke",t.symbolColor),l.exit={opacity:o},l.update=a={opacity:{value:1}},i.x=a.x={field:"offset",mult:.5},i.y=a.y={field:"size",mult:.5,offset:{field:"total",offset:{field:{group:"entryPadding"},mult:{field:"index"}}}},jn.forEach(function(t){e[t]&&(a[t]=i[t]={scale:e[t],field:$n})}),Hn("symbol","legend-symbol",$n,r,l,n)},er=function(e,t,n,r){var i,a={value:0},o=e.title,l={};return l.enter=i={x:{field:{group:"padding"}},y:{field:{group:"padding"}},opacity:a},$e(i,"align",t.titleAlign),$e(i,"baseline",t.titleBaseline),$e(i,"fill",t.titleColor),$e(i,"font",t.titleFont),$e(i,"fontSize",t.titleFontSize),$e(i,"fontWeight",t.titleFontWeight),$e(i,"limit",t.titleLimit),l.exit={opacity:a},l.update={opacity:{value:1},text:o&&o.signal?{signal:o.signal}:{value:o+""}},Hn(Gn,"legend-title",null,r,l,n)},tr=function(e,t,n,r,i,a){return{type:Yn,name:t,role:e,from:n,interactive:r,encode:i,marks:a}},nr=function(e){var t=e.role||"";return t.indexOf("axis")&&t.indexOf("legend")?e.type===Yn?"scope":t||Un:t},rr=function(e){return{clip:e.clip||!1,interactive:!1!==e.interactive,marktype:e.type,name:e.name||void 0,role:e.role||nr(e),zindex:+e.zindex||void 0}},ir=function(e){return e},ar=function(e,r){var i=n.definition(e.type);i||t.error("Unrecognized transform type: "+t.stringValue(e.type));var a=Y(i.type,null,Fe(i,e,r));return e.signal&&r.addSignal(e.signal,r.proxy(a)),a.metadata=i.metadata||{},a},or=function(e,n,r){var i,a,o,l,u;return e?(i=e.facet)&&(n||t.error("Only group marks can be faceted."),null!=i.field?l=u=J(r.getData(i.data).output):(a=r.keyRef(i.groupby),e.data?u=J(r.getData(e.data).aggregate):((o=ar(t.extend({type:"aggregate",groupby:t.array(i.groupby)},i.aggregate))).params.key=a,o.params.pulse=J(r.getData(i.data).output),l=u=J(r.add(o))))):l=J(r.add(Kt(null,[{}]))),l||(l=e.$ref?e:J(e.mark?r.getData(ir(e.mark)).output:r.getData(e.data).output)),{key:a,pulse:l,parent:u}};Xe.fromEntries=function(e,t){var n=t.length,r=1,i=t[0],a=t[n-1],o=t[n-2],l=null;for(e.add(t[0]);r<n;++r)t[r].params.pulse=J(t[r-1]),e.add(t[r]),"Aggregate"===t[r].type&&(l=t[r]);return new Xe(e,i,o,a,l)};var lr=Xe.prototype;lr.countsRef=function(e,t,n){var r,i,a,o=this,l=o.counts||(o.counts={}),u=He(t);return null!=u&&(e=o.scope,r=l[u]),r?n&&n.field&&Ye(e,r.agg.params,n):(a={groupby:e.fieldRef(t,"key"),pulse:J(o.output)},n&&n.field&&Ye(e,a,n),r={agg:i=e.add(Yt(a)),ref:J(r=e.add(Kt({pulse:J(i)})))},null!=u&&(l[u]=r)),r.ref},lr.tuplesRef=function(){return J(this.values)},lr.extentRef=function(e,t){return Ge(e,this,"extent","Extent",t,!1)},lr.domainRef=function(e,t){return Ge(e,this,"domain","Values",t,!1)},lr.valuesRef=function(e,t,n){return Ge(e,this,"vals","Values",t,n||!0)},lr.lookupRef=function(e,t){return Ge(e,this,"lookup","TupleIndex",t,!1)},lr.indataRef=function(e,t){return Ge(e,this,"indata","TupleIndex",t,!0,!0)};var ur=function(e,n,r){var i,a,o,l,u=e.from.facet,s=u.name,d=J(n.getData(u.data).output);u.name||t.error("Facet must have a name: "+t.stringValue(u)),u.data||t.error("Facet must reference a data set: "+t.stringValue(u)),u.field?l=n.add(fn({field:n.fieldRef(u.field),pulse:d})):u.groupby?l=n.add(tn({key:n.keyRef(u.groupby),group:J(n.proxy(r.parent)),pulse:d})):t.error("Facet must specify groupby or field: "+t.stringValue(u)),a=(i=n.fork()).add(Kt()),o=i.add(vn({pulse:J(a)})),i.addData(s,new Xe(i,a,a,o)),i.addSignal("parent",null),l.params.subflow={$subflow:kr(e,i).toRuntime()}},sr=function(e,t,n){var r=t.add(fn({pulse:n.pulse})),i=t.fork();i.add(vn()),i.addSignal("parent",null),r.params.subflow={$subflow:kr(e,i).toRuntime()}},dr=function(e,t,n){var r,i,a=e.remove,o=e.insert,l=e.toggle,u=e.modify,s=e.values,d=t.add(G());r="if("+e.trigger+',modify("'+n+'",'+[o,a,l,u,s].map(function(e){return null==e?"null":e}).join(",")+"),0)",i=Wt(r,t),d.update=i.$expr,d.params=i.$params},fr=function(e,n){var r,i,a,o,l,u,s,d,f,c,p,g,h,m=nr(e),v=e.type===Yn,y=e.from&&e.from.facet,b=e.layout||"scope"===m||m===In,x=m===Un||b||y;a=or(e.from,v,n),f=J(i=n.add(Zt({key:a.key||(e.key?K(e.key):void 0),pulse:a.pulse,clean:!v}))),i=o=n.add(Kt({pulse:f})),c=J(i=n.add(on({markdef:rr(e),context:{$context:!0},groups:n.lookup(),parent:n.signals.parent?n.signalRef("parent"):null,index:n.markpath(),pulse:J(i)}))),(i=n.add(en(Ee(e.encode,e.type,m,n,{pulse:c})))).params.parent=n.encode(),e.transform&&e.transform.forEach(function(e){var r=ar(e,n);(r.metadata.generates||r.metadata.changes)&&t.error("Mark transforms should not generate new data."),r.params.pulse=J(i),n.add(i=r)}),e.sort&&(i=n.add(yn({sort:n.compareRef(e.sort),pulse:J(i)}))),p=J(i),(y||b)&&(g=J(b=n.add(bn({layout:n.objectProperty(e.layout),legendMargin:n.config.legendMargin,mark:c,pulse:p})))),h=J(l=n.add(Jt({mark:c,pulse:g||p}))),v&&(x&&((r=n.operators).pop(),b&&r.pop()),n.pushState(p,g||h,f),y?ur(e,n,a):x?sr(e,n,a):kr(e,n),n.popState(),x&&(b&&r.push(b),r.push(l))),e.overlap&&(h=J(n.add(sn({method:!0===e.overlap?"parity":e.overlap,pulse:h})))),u=n.add(hn({pulse:h})),s=n.add(vn({pulse:J(u)},void 0,n.parent())),null!=e.name&&(d=ir(e.name),n.addData(d,new Xe(n,o,u,s)),e.on&&e.on.forEach(function(e){(e.insert||e.remove||e.toggle)&&t.error("Marks only support modify triggers."),dr(e,n,d)}))},cr=function(e,n){var r,i,a,o,l,u,s,d=e.type||"symbol",f=n.config.legend,c=e.encode||{},p=c.legend||{},g=p.name||void 0,h=!!p.interactive,m=e.size||e.shape||e.fill||e.stroke||e.strokeDash||e.opacity;return m||t.error("Missing valid scale for legend."),r={orient:re(e.orient,f.orient),title:null!=e.title},i=J(n.add(Kt(null,[r]))),p=je({enter:Ke(f),update:{offset:De(re(e.offset,f.offset)),padding:De(re(e.padding,f.padding)),titlePadding:De(re(e.titlePadding,f.titlePadding))}},p,En),u={update:{x:{field:{group:"padding"}},y:{field:{group:"padding"}},entryPadding:De(re(e.entryPadding,f.entryPadding))}},"gradient"===d?(a=J(n.add(an({type:"gradient",scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.objectProperty(e.values),formatSpecifier:n.property(e.format)}))),s=[Jn(m,f,c.gradient),Kn(0,f,c.labels,a)]):(a=J(n.add(an({size:Je(e,f,c.labels),scale:n.scaleRef(m),count:n.property(e.tickCount),values:n.property(e.values),formatSpecifier:n.property(e.format)}))),s=[Zn(e,f,c.symbols,a),Qn(0,f,c.labels,a)]),s=[tr("legend-entry",null,i,h,u,s)],r.title&&(l=er(e,f,c.title,i),u.update.y.offset={field:{group:"titlePadding"},offset:l.encode.update.fontSize||l.encode.enter.fontSize},s.push(l)),o=tr("legend",g,i,h,p,s),e.zindex&&(o.zindex=e.zindex),fr(o,n)},pr=function(e,n){e=t.isString(e)?{text:e}:e;var r,i,a,o=n.config.title,l=t.extend({},e.encode);return r={orient:null!=e.orient?e.orient:o.orient},i=J(n.add(Kt(null,[r]))),l.name=e.name,l.interactive=e.interactive,a=Qe(e,o,l,i),e.zindex&&(a.zindex=e.zindex),fr(a,n)},gr=function(e,n){var r=n.config,i=e.orient,a=i===Pn||i===Dn?r.axisX:r.axisY,o=r["axis"+i[0].toUpperCase()+i.slice(1)],l="band"===n.scaleType(e.scale)&&r.axisBand;return a||o||l?t.extend({},r.axis,a,o,l):r.axis},hr=function(e,t,n,r){var i,a,o,l,u,s=e.orient,d={value:0},f={};return f.enter=i={opacity:d},$e(i,"stroke",t.domainColor),$e(i,"strokeWidth",t.domainWidth),f.exit={opacity:d},f.update=a={opacity:{value:1}},s===Pn||s===Dn?(o="x",u="y"):(o="y",u="x"),l=o+"2",i[u]=d,a[o]=i[o]=nt(e,0),a[l]=i[l]=nt(e,1),Hn("rule","axis-domain",null,r,f,n)},mr=function(e,t,n,r){var i,a,o,l,u,s,d,f,c=e.orient,p=e.gridScale,g=c===On||c===Pn?1:-1,h=g*e.offset||0,m={value:0},v={};return v.enter=i={opacity:m},$e(i,"stroke",t.gridColor),$e(i,"strokeWidth",t.gridWidth),$e(i,"strokeDash",t.gridDash),v.exit=a={opacity:m},v.update=o={},$e(o,"opacity",t.gridOpacity),l={scale:e.scale,field:$n,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra,offset:t.tickOffset},c===Pn||c===Dn?(u="x",s="y",f="height"):(u="y",s="x",f="width"),d=s+"2",o[u]=i[u]=a[u]=l,p?(i[s]={scale:p,range:0,mult:g,offset:h},o[d]=i[d]={scale:p,range:1,mult:g,offset:h}):(i[s]={value:h},o[d]=i[d]={signal:f,mult:g,offset:h}),Hn("rule","axis-grid",$n,r,v,n)},vr=function(e,t,n,r,i){var a,o,l,u,s,d=e.orient,f=d===On||d===Pn?-1:1,c={value:0},p={};return p.enter=a={opacity:c},$e(a,"stroke",t.tickColor),$e(a,"strokeWidth",t.tickWidth),p.exit=o={opacity:c},p.update=l={opacity:{value:1}},u=De(i),u.mult=f,s={scale:e.scale,field:$n,band:t.bandPosition,round:t.tickRound,extra:t.tickExtra,offset:t.tickOffset},d===Pn||d===Dn?(l.y=a.y=c,l.y2=a.y2=u,l.x=a.x=o.x=s):(l.x=a.x=c,l.x2=a.x2=u,l.y=a.y=o.y=s),Hn("rule","axis-tick",$n,r,p,n)},yr=function(e,t,n,r,i){var a,o,l,u,s,d=e.orient,f=e.labelOverlap,c=d===On||d===Pn?-1:1,p=null!=e.labelPadding?e.labelPadding:t.labelPadding,g={value:0},h={};return h.enter=a={opacity:g},$e(a,"angle",t.labelAngle),$e(a,"fill",t.labelColor),$e(a,"font",t.labelFont),$e(a,"fontSize",t.labelFontSize),$e(a,"limit",t.labelLimit),h.exit=o={opacity:g},h.update=l={opacity:{value:1},text:{field:"label"}},u=De(i),u.mult=c,u.offset=De(p),u.offset.mult=c,s={scale:e.scale,field:$n,band:.5,offset:t.tickOffset},d===Pn||d===Dn?(l.y=a.y=u,l.x=a.x=o.x=s,$e(l,"align","center"),$e(l,"baseline",d===Pn?"bottom":"top")):(l.x=a.x=u,l.y=a.y=o.y=s,$e(l,"align","right"===d?"left":"right"),$e(l,"baseline","middle")),e=Hn(Gn,"axis-label",$n,r,h,n),e.overlap=f||t.labelOverlap,e},br=function(e,t,n,r){var i,a,o,l=e.orient,u=e.title,s=l===On||l===Pn?-1:1,d=l===Pn||l===Dn,f={};return f.enter=i={opacity:{value:0}},$e(i,"align",t.titleAlign),$e(i,"fill",t.titleColor),$e(i,"font",t.titleFont),$e(i,"fontSize",t.titleFontSize),$e(i,"fontWeight",t.titleFontWeight),$e(i,"limit",t.titleLimit),f.exit={opacity:{value:0}},f.update=a={opacity:{value:1},text:u&&u.signal?{signal:u.signal}:{value:u+""}},o={scale:e.scale,range:.5},d?(a.x=o,a.angle={value:0},a.baseline={value:l===Pn?"bottom":"top"}):(a.y=o,a.angle={value:90*s},a.baseline={value:"bottom"}),$e(a,"angle",t.titleAngle),$e(a,"baseline",t.titleBaseline),!$e(a,"x",t.titleX)&&d&&!Ve("x",n)&&(f.enter.auto={value:!0}),!$e(a,"y",t.titleY)&&!d&&!Ve("y",n)&&(f.enter.auto={value:!0}),Hn(Gn,"axis-title",null,r,f,n)},xr=function(e,t){var n,r,i,a,o,l,u=gr(e,t),s=e.encode||{},d=s.axis||{},f=d.name||void 0,c=!!d.interactive;return n={orient:e.orient,ticks:!!re(e.ticks,u.ticks),labels:!!re(e.labels,u.labels),grid:!!re(e.grid,u.grid),domain:!!re(e.domain,u.domain),title:!!re(e.title,!1)},r=J(t.add(Kt({},[n]))),d=je({update:{range:{signal:'abs(span(range("'+e.scale+'")))'},offset:De(re(e.offset,0)),position:De(re(e.position,0)),titlePadding:De(re(e.titlePadding,u.titlePadding)),minExtent:De(re(e.minExtent,u.minExtent)),maxExtent:De(re(e.maxExtent,u.maxExtent))}},s.axis,En),i=J(t.add(Gt({scale:t.scaleRef(e.scale),extra:u.tickExtra,count:t.property(e.tickCount),values:t.objectProperty(e.values),formatSpecifier:t.property(e.format)}))),l=[],n.grid&&l.push(mr(e,u,s.grid,i)),n.ticks&&(a=re(e.tickSize,u.tickSize),l.push(vr(e,u,s.ticks,i,a))),n.labels&&(a=n.ticks?a:0,l.push(yr(e,u,s.labels,i,a))),n.domain&&l.push(hr(e,u,s.domain,r)),n.title&&l.push(br(e,u,s.title,r)),o=tr("axis",f,r,c,d,l),e.zindex&&(o.zindex=e.zindex),fr(o,t)},kr=function(e,n,r){var i=t.array(e.signals),a=t.array(e.scales);return r||i.forEach(function(e){pt(e,n)}),t.array(e.projections).forEach(function(e){zn(e,n)}),a.forEach(function(e){le(e,n)}),t.array(e.data).forEach(function(e){Ze(e,n)}),a.forEach(function(e){ue(e,n)}),i.forEach(function(e){Ut(e,n)}),t.array(e.axes).forEach(function(e){xr(e,n)}),t.array(e.marks).forEach(function(e){fr(e,n)}),t.array(e.legends).forEach(function(e){cr(e,n)}),e.title&&pr(e.title,n),n.parseLambdas(),n},Sr=t.toSet(["width","height","padding","autosize"]),Rr=it.prototype=at.prototype;Rr.fork=function(){return new at(this)},Rr.toRuntime=function(){return this.finish(),{background:this.background,operators:this.operators,streams:this.streams,updates:this.updates,bindings:this.bindings,eventConfig:this.eventConfig}},Rr.id=function(){return(this._subid?this._subid+":":0)+this._id++},Rr.add=function(e){return this.operators.push(e),e.id=this.id(),e.refs&&(e.refs.forEach(function(t){t.$ref=e.id}),e.refs=null),e},Rr.proxy=function(e){var t=e instanceof H?J(e):e;return this.add(pn({value:t}))},Rr.addStream=function(e){return this.streams.push(e),e.id=this.id(),e},Rr.addUpdate=function(e){return this.updates.push(e),e},Rr.finish=function(){function e(e,t,n){var r;e&&((r=e.data||(e.data={}))[t]||(r[t]=[])).push(n)}var t,n;this.root&&(this.root.root=!0);for(t in this.signals)this.signals[t].signal=t;for(t in this.scales)this.scales[t].scale=t;for(t in this.data){e((n=this.data[t]).input,t,"input"),e(n.output,t,"output"),e(n.values,t,"values");for(var r in n.index)e(n.index[r],t,"index:"+r)}return this},Rr.pushState=function(e,t,n){this._encode.push(J(this.add(vn({pulse:e})))),this._parent.push(t),this._lookup.push(n?J(this.proxy(n)):null),this._markpath.push(-1)},Rr.popState=function(){this._encode.pop(),this._parent.pop(),this._lookup.pop(),this._markpath.pop()},Rr.parent=function(){return t.peek(this._parent)},Rr.encode=function(){return t.peek(this._encode)},Rr.lookup=function(){return t.peek(this._lookup)},Rr.markpath=function(){var e=this._markpath;return++e[e.length-1]},Rr.fieldRef=function(e,n){if(t.isString(e))return K(e,n);e.signal||t.error("Unsupported field reference: "+t.stringValue(e));var r,i=e.signal,a=this.field[i];return a||(r={name:this.signalRef(i)},n&&(r.as=n),this.field[i]=a=J(this.add(nn(r)))),a},Rr.compareRef=function(e){function n(e){return ne(e)?(i=!0,J(r[e.signal])):e}var r=this.signals,i=!1,a=t.array(e.field).map(n),o=t.array(e.order).map(n);return i?J(this.add(Qt({fields:a,orders:o}))):Q(a,o)},Rr.keyRef=function(e){var n=this.signals,r=!1;return e=t.array(e).map(function(e){return ne(e)?(r=!0,J(n[e.signal])):e}),r?J(this.add(rn({fields:e}))):Z(e)},Rr.sortRef=function(e){if(!e)return e;var t=[te(e.op,e.field),It],n=e.order||"ascending";return n.signal?J(this.add(Qt({fields:t,orders:[n=this.signalRef(n.signal),n]}))):Q(t,[n,n])},Rr.event=function(e,t){var n=e+":"+t;if(!this.events[n]){var r=this.id();this.streams.push({id:r,source:e,type:t}),this.events[n]=r}return this.events[n]},Rr.addSignal=function(e,n){this.signals.hasOwnProperty(e)&&t.error("Duplicate signal name: "+t.stringValue(e));var r=n instanceof H?n:this.add(G(n));return this.signals[e]=r},Rr.getSignal=function(e){return this.signals[e]||t.error("Unrecognized signal name: "+t.stringValue(e)),this.signals[e]},Rr.signalRef=function(e){return this.signals[e]?J(this.signals[e]):(this.lambdas.hasOwnProperty(e)||(this.lambdas[e]=this.add(G(null))),J(this.lambdas[e]))},Rr.parseLambdas=function(){for(var e=Object.keys(this.lambdas),t=0,n=e.length;t<n;++t){var r=e[t],i=Wt(r,this),a=this.lambdas[r];a.params=i.$params,a.update=i.$expr}},Rr.property=function(e){return e&&e.signal?this.signalRef(e.signal):e},Rr.objectProperty=function(e){return e&&t.isObject(e)?this.signalRef(e.signal||ot(e)):e},Rr.addBinding=function(e,n){this.bindings||t.error("Nested signals do not support binding: "+t.stringValue(e)),this.bindings.push(t.extend({signal:e},n))},Rr.addScaleProj=function(e,n){this.scales.hasOwnProperty(e)&&t.error("Duplicate scale or projection name: "+t.stringValue(e)),this.scales[e]=this.add(n)},Rr.addScale=function(e,t){this.addScaleProj(e,mn(t))},Rr.addProjection=function(e,t){this.addScaleProj(e,cn(t))},Rr.getScale=function(e){return this.scales[e]||t.error("Unrecognized scale name: "+t.stringValue(e)),this.scales[e]},Rr.projectionRef=Rr.scaleRef=function(e){return J(this.getScale(e))},Rr.projectionType=Rr.scaleType=function(e){return this.getScale(e).params.type},Rr.addData=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.data[e]=n},Rr.getData=function(e){return this.data[e]||t.error("Undefined data set name: "+t.stringValue(e)),this.data[e]},Rr.addDataPipeline=function(e,n){return this.data.hasOwnProperty(e)&&t.error("Duplicate data set name: "+t.stringValue(e)),this.addData(e,Xe.fromEntries(this,n))};var wr=function(e){var n=st();return(e||[]).forEach(function(e){var r;if(e)for(r in e)n[r]=t.isObject(n[r])?t.extend(n[r],e[r]):n[r]=e[r]}),n},zr=30,Pr=2,Or="#4c78a8",Dr="#000",$r="#888",jr="#ddd";e.parse=function(e,n){return t.isObject(e)||t.error("Input Vega specification must be an object."),rt(e,new it(wr([n,e.config]))).toRuntime()},e.signal=pt,e.signalUpdates=Ut,e.stream=Bt,e.codeGenerator=Ct,e.functionContext=Et,e.expressionFunction=L,e.MarkRole=Un,e.FrameRole=In,e.ScopeRole="scope",e.AxisRole="axis",e.AxisDomainRole="axis-domain",e.AxisGridRole="axis-grid",e.AxisLabelRole="axis-label",e.AxisTickRole="axis-tick",e.AxisTitleRole="axis-title",e.LegendRole="legend",e.LegendEntryRole="legend-entry",e.LegendLabelRole="legend-label",e.LegendSymbolRole="legend-symbol",e.LegendTitleRole="legend-title",e.Scope=it,e.DataScope=Xe,e.formatLocale=o.formatDefaultLocale,e.timeFormatLocale=l.timeFormatDefaultLocale,Object.defineProperty(e,"__esModule",{value:!0})});